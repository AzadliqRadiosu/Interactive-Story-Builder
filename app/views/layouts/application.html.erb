<!DOCTYPE html>
<html lang="<%= I18n.locale %>">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= content_for?(:title) ? "#{yield(:title)} | #{t('app.common.app_name')}" :
				t('app.common.app_name') %></title>
    <%= csrf_meta_tags %>
	  <%= include_gon %>



		  <meta property="og:title" content="<%= content_for?(:title) ? ("#{yield(:title)} | #{t('app.common.app_name')}").html_safe :
				  t('app.common.app_name').html_safe %>" />
		  <% if false %>
        <meta name="description" content="">
    		<meta property="og:description" content="" />
      <% end %>
		  <meta property="og:type" content="non_profit" />
		  <meta property="og:url" content="<%= current_url %>" />
		  <% if @story && @story.id && @story.asset_exists? %>
			  <meta property="og:image" content="<%= full_url(@story.asset.asset.url(:"250x250", false)) %>" />
      <% else %>
			  <!--meta property="og:image" content="" /-->
		  <% end %>
		  <meta property="og:site_name" content="<%= t('app.common.app_name') %>" />
		  <meta property="fb:app_id" content="<%= ENV['STORY_BUILDER_FACEBOOK_APP_ID'] %>" />


    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
    <![endif]-->

    <%= stylesheet_link_tag "application", :media => "all" %>
	<% if @usemap %>
		<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.css" />
	<% end %>
    

		<!--[if IE 6]><%= stylesheet_link_tag 'ie6' %><![endif]-->
	  <!--[if IE 7]><%= stylesheet_link_tag 'ie7' %><![endif]-->

    <!-- For all other devices -->
    <!-- Size should be 32 x 32 pixels -->
    <%= favicon_link_tag '/favicon.ico', :rel => 'shortcut icon' %>
  </head>
  <body>
 <!--    < render partial: "layouts/nav_bar"%>    -->

      <nav class="navbar navbar-default navbar-static-top">
      <div class="container-fluid">
      	<div class="pull-left nav-logo">
	      	<%= link_to(image_tag("logo.png",:size=>"182x29",:style=>"vertical-align:middle;",:alt=>t('app.common.app_name')) , root_path(:locale => I18n.locale))%>
      	   	<% if @story.present? && showing_story %>

            	<%= link_to(@story.title, root_path(:locale => I18n.locale), :class=>"navigation-headline brand font" , :"data-target"=>".nav-collapse", :"data-toggle"=>"collapse")%>  
          	<% end %>
		    </div>
          <div class="nav-collapse nav-user pull-right">
	          <ul class="nav">         
                    
		          <% if user_signed_in? %>
  		          <% if current_user.avatar.present? %>
          		        <li >
				          	<%= link_to image_tag(current_user.avatar,:size=>"28x28", :class=>"avatar"), "#" , 
				          	     :class => "dropdown-toggle avatar-link", :"data-toggle"=>"dropdown" %>				
		          				 
				          <ul class="dropdown-menu">
                    <li>
                      <%= link_to t('helpers.links.add_story'), new_story_path  %>
                    </li>              
                    <li>
                      <%= link_to t('helpers.titles.story_list'), stories_path  %>
                    </li>              
                    <% if current_user.role? User::ROLES[:admin] %>
                      <li>
                       <%= link_to t('helpers.links.news'), admin_news_index_path %>
                      </li>
                      <li>
                       <%= link_to t('helpers.links.users'), admin_users_path %>
                      </li>
                    <% end %>     
						        <li>
				 		         <%= link_to t('helpers.links.sign_out'), destroy_user_session_path, :method => :delete %>
										</li>
				          </ul>
				        </li>


                <% end %>			           			

				        <% else %>
				         <li>
				        	<%= link_to t('helpers.links.sign_in2'), :new_user_session %>
			        	</li>
		         	 <% end %> 
							<% I18n.available_locales.each do |locale| %>
								<% if locale != I18n.locale %>
									<li><%= link_to t("app.language.#{locale}"), params.merge(:locale => locale) , :"data-target"=>".nav-collapse", :"data-toggle"=>"collapse"%></li>
								<% end %>
							<% end %>
			

              <% if @story.present? && @story.sections.present? && showing_story %>
                <li class="divider-vertical"></li>
                
                <li><a href="#" class="navigation-volume"><div class="navigation-icon"></div></a></li>             
                 <li>
                  <% markers = @story.sections.select{|t| (t.ok? && t.has_marker? == true) } %>      
                  <% if markers.length > 1 %>    
                    <div class="navigation-sections">     
                     <% markers.each_with_index do |s,s_i| %>
                      <a href="#<%= s_i+1 %>" class="navigation-section" title="<%= s.title %>"><%= s_i+1 %></a>
                     <% end %>          
                    </div>
                  <% end %>
                </li>            
              <% end %>
	          </ul>

           </div>
      </nav>
     <header class="header">
      <div class="header-data">
        <div class="h1">Build and Share</div>
        <div class="h3">the Next Generation Story</div>
        <div class="intro">Story builder allows anyone with text, pictures and/or videos to<br>
        combine this content into a creative story
        that can be published<br> and shared with the world</div>
        <div class="btn-create-story">
               <%= link_to  "Start Story", new_story_path, :tabindex=>1 %>
          </div>       
      </div>
    </header>
    <div id="filter">
      <div class="container">
        <ul class="nav">
          <li><a href="#" tabindex="12">Staff Picks</a></li>
          <li class="divider-vertical"></li>
   

        <li class="dropdown">
         <a href="#" class="dropdown-toggle" data-toggle="dropdown" tabindex="13">
                        Trending
                        <b class="caret"></b>
                        </a>
          <ul class="dropdown-menu">
            <li class="dropdown">Recent</li>
            <li class="dropdown">Viewed</li>
            <li class="dropdown">Faved</li>
            <li class="dropdown">Commented</li>
          </ul>
        </li>
         <li class="dropdown" tabindex="14">
          
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" >
                        Category
                        <b class="caret"></b>
                        </a>
          <ul class="dropdown-menu">          
            <li class="dropdown">Animal</li>
          </ul>
        </li>
        <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" tabindex="15">
                        Language
                        <b class="caret"></b>
                        </a>
          <ul class="dropdown-menu">          
            <li class="dropdown">French</li>
          </ul>
        </li>
        <div class="pull-right">
            <div class="search-label">Find the story</div>         
            <div class="search-wrapper">  

            <div class="search-box">          
                <div class="search-text">

                  <input type="text" placeholder="Find the story" tabindex="16"/>

                </div>  
                <div class="search-button"></div>
            </div>         
          </div> 
       
          </div>
        </ul>


          
      </div>
   
       <!-- <div class="search-label">Find the story</div>     -->
    

    </div>

		<div id="wrapper">
		  <div class="container">
		    <div class="content">
		      <div class="row">
		         <div class="col-md-12">
		         		<div class="flash-message">
							<% flash.each do |key, msg| %>
								<div class="alert <%= flash_translation(key) %> fade in">
									<a href="#" data-dismiss="alert" class="close">Ã—</a>
									<%= msg %>
								</div>
							<% end %>
						</div>

		<!-- 					<% if content_for?(:title) %>
								<div class="page-header">
								  <div class="block">
			              <h1>
										  <%= yield(:title) %>
									  </h1>
									</div>
								</div>
							<% end %> -->

	            <%= yield %>
	          </div><!--/span-->
		      </div><!--/row-->
		    </div><!--/content-->
		   </div> <!-- /container -->
		</div><!--/wrapper-->

    <div class="push"><!--//--></div>

    <footer class="clear">
      <div class="container">
  		<div id="left"><span class="copyright">&copy; <%= Time.now.year %> </span>
        <div class="social">                                      
        <a href='https://twitter.com/share?text=<%= content_for?(:title) ? "#{yield(:title)} | #{t('app.common.app_name')}" :
        t('app.common.app_name') %>' onclick="javascript:window.open(this.href,
          '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;"><img src="assets/twitter.png"/></a>    
        <a href="https://plus.google.com/share?url=<%= current_url %>" onclick="javascript:window.open(this.href,
          '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;"><img src="assets/google_plus.png" alt="Share on Google+"/></a>                                
          <div class="facebook">  <div class="fb-like" data-href="<%= current_url %>" data-layout="button_count" data-action="like" data-show-faces="false" data-share="true" ></div></div>
      </div>  
      </div>
   
    	<div id="middle">
        <ul>
          <li>
            <%= link_to t('helpers.links.news'), news_path %>
          </li>
          <li>
            <%= link_to t('helpers.links.todo_list'), todo_list_path %> 
          </li>
          <li>
            <%= link_to t('helpers.links.feedback'), feedback_path %> 
          </li>
           <li>
            <%= link_to t('helpers.links.about'), feedback_path %> 
          </li>
           <li>
            <%= link_to t('helpers.links.demo'), feedback_path %> 
          </li>
          <li>
            <!--  image_tag("github.png",:size=>"28x28",:style=>"vertical-align:middle;") -->
                  <%= link_to "GitHub", "https://github.com/JumpStartGeorgia/Interactive-Story-Builder.git", :style => "height:40px;line-height:40px;" %>
          </li>
          
  		
        </ul>
    	</div>
  		<div id="right">
  			<%= link_to(image_tag("logojs.png"), "http://www.jumpstart.ge", :target => "_blank",
  					:title => t(".js_link_title")	) %>
  		</div>
      </div>
    </footer>

    <!-- Javascripts
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <%= javascript_include_tag "application" %>
		<script type="text/javascript">
			I18n.defaultLocale = "<%= I18n.default_locale %>";
			I18n.locale = "<%= I18n.locale %>";
		</script>
		<% if @usemap %>
  		<script src="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.js" type="text/javascript"></script>
		<% end %>
		<% if @load_ollyjs %>
  		<script src="/assets/olly.js" type="text/javascript"></script>
		<% end %>
		<% if Rails.env.production? %>
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-12801815-33', 'jumpstart.ge');
        ga('send', 'pageview');

      </script>
		<% end %>
    <script>
       var scrollOffset = 0;
       var isNavVisible = true;
       function navbarMagic(reset)
       {      
            reset = typeof reset !== 'undefined' ?  reset : false;
            var currentOffset = $(this).scrollTop();
            var objectOffset = $("#filter").offset().top;
            var topOffsetBack = 150;
            //console.log("Offset from top: "+$(this).scrollTop());            
            //down
          if(reset)
          {
            if(scrollOffset <= objectOffset-topOffsetBack)
            {
                 isNavVisible = true; 
              $(".navbar").queue(function(){
                    $(this).fadeOut(400,function(){
                      $(this).css("background-color","rgba(255,255,255,0.0)")
                      $(this).css("position","absolute");
                      $(this).css("top","30px");                                            
                    }).fadeIn(10).dequeue();   
                    //animate({}, 1000,function(){ }).dequeue();                   
                    
                 });
            }
            else
            {                
                $(".navbar").css("position","fixed").css("top","0px").queue(function(){
                  $(this).animate({"background-color":"#000"}, 1000).dequeue();
                }); 
                isNavVisible = false;
            }
          }
          else
          {
            if(scrollOffset < currentOffset)
            {              
              //console.log("down");
              if(scrollOffset <= objectOffset-topOffsetBack && currentOffset >= objectOffset-topOffsetBack)
              {
                //console.log("navbar visible");
               // $(".navbar").toggleClass("navbar-static-top navbar-fixed-top").css("background-color","#000");                
                 $(".navbar").css("position","fixed").css("top","0px").queue(function(){
                    $(this).animate({"background-color":"#000"}, 1000).dequeue();
                  }); 
              }
              isNavVisible = false;
            }
            else 
            {
              //console.log("up");
              if(!isNavVisible && currentOffset <= objectOffset - 60)
              {      
              isNavVisible = true;          
                //console.log("navbar invisible");
               // $(".navbar").toggleClass("navbar-static-top navbar-fixed-top").css("background-color","transparent");
                //$(".navbar").css("background-color","transparent").css("position","absolute");
                 $(".navbar").queue(function(){
                    $(this).fadeOut(400,function(){
                      $(this).css("background-color","rgba(255,255,255,0.0)")
                      $(this).css("position","absolute");
                      $(this).css("top","30px");                                            
                    }).fadeIn(10).dequeue();   
                    //animate({}, 1000,function(){ }).dequeue();                   
                    
                 });
              }
            }
          }
            scrollOffset = currentOffset;
       }
      $(document).ready(function() {  
          var sa = false;
          var sl = true;


          // $('.search-box').click(function(){
          //   console.log("click");
          //   if(!sa)
          //   {
          //     if(sl)
          //       {
          //         $(".search-label").hide();
          //         console.log("label 0");    
          //         sl = false;    
          //       }
          //     $(".search-box").addClass("active");                 
          //     sa = true; 
              
          //     $('.search-box input').focus();   
          //      console.log("click input focus"); 
          //   }      
          // });

          // $('.search-box input').focus(function(){
          //   console.log("focus input");
          //   if(!sa)
          //   {
          //     $(".search-box").addClass("active");  
          //     sa = true; 
          //     sl = false;                        
          //   }
          // });
          //  $('.search-box').focus(function(){
          //   $(".search-box").addClass("active");  
          //   sa = true; 
          //   sl = false;                        
          // });
          $('.search-box input').focusout(function(){
            if($(this).val().length==0)
            {
              $(".search-box").removeClass("active");
              $(".search-label").show();                     
              sa = false;
              sl = true;     
            }
      
          });
           $('.search-box').hover(function()
           {        
              if(!sa)
              {
                 $(".search-box").addClass("active");  
                 sa = true; 
                 sl = false;     
                 $(".search-label").hide();
              }
           },
           function(){
            if($(this).find("input").val().length==0 && sa)
          {
                $(this).find("input").trigger("blur");
                 $(".search-box").removeClass("active");  
                 sa = false; 
                 $(".search-label").show();                
                 sl = true;     
              }
           });


   $(".search-button").click(function(){ console.log("ajax search");});
        
          scrollOffset = $(window).scrollTop();      
          $(window).scroll(function(){navbarMagic();});
          navbarMagic(true);
      });

      </script>

  </body>
</html>