<%= remotipart_response do %>
  <% if remotipart_submitted? 
      msg = ""
      msg_type = ""
      [:success, :notice, :error, :alert].each do |type|        
            msg = flash[type] unless flash[type].blank?
            msg_type = type.to_s unless flash[type].blank?                       
      end      
    %>    
    <% if !msg.empty? %>
      popuper('<%= msg %>' , '<%= msg_type %>');
    <% end %>   
  <% end %>
<% end %>

if(item_id != -1)
{
  $('.story-tree ul li.item[id='+ section_id + ']').find(' ul li.sub[id='+item_id+'] > div > .sub-l').text('<%= @item.title %>').trigger('click');   
}
else 
{
	$('.story-tree ul li.item[id='+ section_id + '] > .box > .title').text('<%= @item.title %>').trigger('click');
}	

<% if @select_next %>
  select_next();
<% end %>

<% if @story_progress.present? %>
  if ($('.toolbar select#translateTo').length > 0){
    var progress = <%= @story_progress.to_json.html_safe %>;
    // get current to locale
    var to = '<%= @item.current_locale %>';
    console.log(to);
    // if the to locale is in the progress list, let's update the text in the drop down list
    var match = $.grep(progress, function(x){
      return x.locale == to;
    });
    // create percent
    var percent = '<%= compute_translation_progress_percent(@item.current_locale, @story_progress) %>';
    console.log(match);
    console.log(percent);
    if (match != undefined && percent != undefined){
      console.log('lets go!');
      // found match, now need to udpate text
      var optionTo = $('.toolbar select#translateTo option[value="' + to + '"]');
      var pickerTo = $('.toolbar select#translateTo + .bootstrap-select');
      var optionFrom = $('.toolbar select#translateFrom option[value="' + to + '"]');
      var pickerFrom = $('.toolbar select#translateFrom + .bootstrap-select');
      var publishTo = $('.toolbar .right-view a.btnPublish');
      var text;
      var orig_text = $(optionTo).html();
      console.log($(optionTo).html());
      if ($(optionTo).html().indexOf(' (') > -1){
        // already has percent, so need to replace
        text = $(optionTo).html().replace(/\s\(\d{1,3}%\)/,  ' (' +  percent + ')');
      }else{
        // not have percent, so need to add
        text = $(optionTo).html() + ' (' +  percent + ')'
      }
      console.log(text);
      $(optionTo).html(text);
      $(pickerTo).find(" > button").attr('title', text);
      $(pickerTo).find(" > button span.filter-option").html(text);
      $(pickerTo).find(" .dropdown-menu ul li a span.text:contains('" + orig_text + "')").html(text);
      $(pickerFrom).find(" .dropdown-menu ul li a span.text:contains('" + orig_text + "')").html(text);
      $(publishTo).attr('data-percent', percent);
      
      // if to is 100%, then turn on publish button
      if (percent == '100%'){
        $(publishTo).toggleClass('btn-publish-disabled btn-publish').removeClass('hide');
      }
    }
  }

<% end %>
